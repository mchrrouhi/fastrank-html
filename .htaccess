# ============================================
# FASTRANK.IO - APACHE REWRITE RULES
# ============================================

RewriteEngine On
RewriteBase /

# ============================================
# SECURITY & BEST PRACTICES
# ============================================

# Disable directory browsing
Options -Indexes

# Protect .htaccess itself
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

# ============================================
# CLEAN URLs FOR BLOG POSTS
# ============================================

# Don't rewrite existing files/directories (CSS, JS, images, fonts, etc.)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 301 Redirect: /blog/post-name.html → /blog/post-name/
# This ensures old links are redirected for SEO
RewriteCond %{REQUEST_URI} ^/blog/(.+)\.html$
RewriteRule ^blog/(.+)\.html$ /blog/$1/ [R=301,L]

# Internal rewrite: /blog/post-name/ → /blog/post-name.html
# Serves the actual HTML file without exposing the extension
RewriteCond %{REQUEST_URI} ^/blog/(.+)/$
RewriteCond %{DOCUMENT_ROOT}/blog/$1.html -f
RewriteRule ^blog/(.+)/$ /blog/$1.html [L]

# Handle /blog/post-name (no trailing slash) → add trailing slash
# For consistency and to avoid duplicate content issues
RewriteCond %{REQUEST_URI} ^/blog/[^/]+$
RewriteCond %{REQUEST_URI} !^/blog/$
RewriteCond %{REQUEST_URI} !\.(css|js|jpg|jpeg|png|gif|svg|webp|woff|woff2|ttf|ico|webmanifest|xml|txt)$
RewriteCond %{DOCUMENT_ROOT}/blog%{REQUEST_URI}.html -f
RewriteRule ^blog/(.+)$ /blog/$1/ [R=301,L]

# ============================================
# OPTIONAL: CLEAN URLs FOR ROOT-LEVEL PAGES
# (Uncomment if you want about.html → /about/)
# ============================================

# RewriteCond %{REQUEST_URI} ^/(.+)\.html$
# RewriteCond %{REQUEST_URI} !^/index\.html$
# RewriteRule ^(.+)\.html$ /$1/ [R=301,L]

# RewriteCond %{REQUEST_URI} ^/([^/]+)/$
# RewriteCond %{REQUEST_URI} !^/blog/
# RewriteCond %{DOCUMENT_ROOT}/$1.html -f
# RewriteRule ^([^/]+)/$ /$1.html [L]

# ============================================
# CACHING & PERFORMANCE
# ============================================

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>

# ============================================
# GZIP COMPRESSION
# ============================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/atom_xml
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>
